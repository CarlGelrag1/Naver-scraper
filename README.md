# Naver Shopping Review Scraper

这是一个基于 Python 的异步网络爬虫，旨在使用 Selenium 从 Naver Shopping 的商品页面上抓取详细的评论数据。脚本能够模拟真实用户行为以绕过基础的反爬虫机制，并支持批量处理多个商品链接，最终将所有评论数据整理并保存到 Excel 文件中。

## ✨ 功能特点

-   **异步抓取**: 使用 `asyncio` 库进行异步操作，提高处理多个链接时的效率。
-   **智能反爬虫**:
    -   随机轮换 User-Agent。
    -   通过禁用自动化标志和优化浏览器设置来减少被检测的风险。
    -   在抓取前先访问 Naver 首页，模拟真实会话。
    -   在操作之间插入随机延迟，模拟人类行为。
-   **强大的分页处理**: 能够自动处理复杂的评论分页逻辑（包括页码组切换），抓取所有评论。
-   **稳健的错误处理**:
    -   使用安全的元素获取方法，即使某个字段缺失也不会导致程序崩溃。
    -   为关键操作（如点击按钮）添加了重试机制。
-   **手动验证码处理**: 当检测到 CAPTCHA 验证码时，程序会暂停并提示用户手动解决，增强了实用性。
-   **详细数据提取**: 抓取包括商品标题、价格、总评分、用户名、评论星级、时间、内容、点赞数、图片链接等在内的丰富信息。
-   **自动化文件管理**:
    -   自动创建输出文件夹 (`naver商品`)。
    -   以商品标题为名，为每个商品生成一个独立的 Excel 文件。
    -   在 Excel 文件中包含一个总计行，方便快速了解商品概况。

## 📋 环境要求

-   Python 3.7+
-   Google Chrome 浏览器

## 🚀 安装与配置

1.  **克隆或下载脚本**:
    将此代码保存为 `naver_scraper.py`（或任何你喜欢的名字）。

2.  **安装所需的 Python 库**:
    打开终端或命令行，运行以下命令来安装所有依赖项。

    ```bash
    pip install pandas selenium webdriver-manager openpyxl
    ```

## 💡 使用方法

1.  **运行脚本**:
    在终端中执行脚本：
    ```bash
    python naver_scraper.py
    ```

2.  **输入链接**:
    程序会提示你输入 Naver Shopping 的商品链接。每个链接占一行。
    ```
    请输入要爬取的Naver商品链接，每行一个链接，输入空行结束:
    https://smartstore.naver.com/your/products/12345
    https://smartstore.naver.com/another/products/67890
    ```

3.  **开始抓取**:
    输入完所有链接后，按一次 `Enter` 键（输入一个空行）即可开始抓取过程。

4.  **处理验证码 (如果需要)**:
    如果脚本在运行时检测到验证码，浏览器窗口会显示验证码页面，同时终端会提示：
    `检测到验证码，请手动解决`
    `解决验证码后按回车继续...`
    此时，请在自动打开的浏览器窗口中完成验证，然后回到终端按 `Enter` 键继续。

5.  **查看结果**:
    脚本运行结束后，所有的评论数据将保存在项目目录下的 `naver商品` 文件夹中。每个商品对应一个 `.xlsx` 文件。

## 📄 输出格式

每个 Excel 文件包含以下列，并在第一行提供了一个商品摘要：

| 商品标题 | 商品链接 | 商品价格 | 总星级 | 评论数量 | 用户名 | 评论星级 | 评论时间 | 购买规格 | 评论内容 | 点赞数 | 图片链接 | 图片数量 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| [商品A] | [URL A] | 10000 | 4.8 | 1234 | **TOTAL** | | | | 总计1234条评论 | | | |
| [商品A] | [URL A] | 10000 | 4.8 | 1234 | 用户1 | 5 | 24.01.01 | 规格X | 评论内容... | 5 | [URL] | 1 |
| [商品A] | [URL A] | 10000 | 4.8 | 1234 | 用户2 | 4 | 24.01.02 | 规格Y | 评论内容... | 2 | | 0 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

## ⚙️ 代码结构解析

-   **`NaverScraper` 类**:
    -   `__init__(self, urls, output_dir)`: 初始化爬虫，接收 URL 列表和输出目录。
    -   `_get_chrome_options(self)`: 配置 Selenium WebDriver 的选项，这是反爬虫策略的核心。
    -   `scrape_all(self)`: 异步主循环，遍历所有 URL 并调用 `scrape_url`。
    -   `scrape_url(self, url)`: 单个 URL 的核心抓取逻辑，包括页面导航、数据提取和分页处理。
    -   `_extract_review_data(...)`: 辅助函数，用于从单个评论元素中解析出所有字段。
    -   `_safe_get_text(self, driver, xpath)` / `_safe_get_attribute(...)`: 安全的辅助函数，用于获取元素文本或属性，避免因元素不存在而报错。

-   **`main()` 函数**:
    -   作为程序的入口点，负责接收用户输入的 URL 并启动 `NaverScraper`。

## ⚠️ 免责声明

-   本工具仅供学习和技术研究使用。
-   请勿用于任何商业或非法用途。
-   频繁抓取可能会对目标网站服务器造成压力，请合理使用，并遵守 Naver 的服务条款（Terms of Service）。
-   用户需自行承担因使用本工具而产生的一切风险和责任。
